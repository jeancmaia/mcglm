<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mcglm.mcglm &mdash; mcglm 0.2.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=6ffd866b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            mcglm
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">mcglm</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">mcglm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">mcglm.mcglm</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mcglm.mcglm</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ncx2</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span><span class="p">,</span> <span class="n">slogdet</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">block_diag</span>
<span class="kn">from</span> <span class="nn">statsmodels.iolib.summary</span> <span class="kn">import</span> <span class="n">Summary</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.generalized_linear_model</span> <span class="kn">import</span> <span class="n">GLM</span><span class="p">,</span> <span class="n">GLMResults</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.families.links</span> <span class="kn">import</span> <span class="n">probit</span><span class="p">,</span> <span class="n">cauchy</span><span class="p">,</span> <span class="n">CLogLog</span><span class="p">,</span> <span class="n">LogLog</span>
<span class="kn">from</span> <span class="nn">.mcglmmean</span> <span class="kn">import</span> <span class="n">MCGLMMean</span>
<span class="kn">from</span> <span class="nn">.mcglmvariance</span> <span class="kn">import</span> <span class="n">MCGLMVariance</span>
<span class="kn">from</span> <span class="nn">.mcglmcattr</span> <span class="kn">import</span> <span class="n">MCGLMCAttributes</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">mc_sandwich</span>


<div class="viewcode-block" id="MCGLM">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLM">[docs]</a>
<span class="k">class</span> <span class="nc">MCGLM</span><span class="p">(</span><span class="n">MCGLMMean</span><span class="p">,</span> <span class="n">MCGLMVariance</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    MCGLM class that implements MCGLM stastical models. (Bonat, JÃ¸rgensen 2015)</span>
<span class="s2">        </span>
<span class="s2">    It extends GLM for multi-responses and dependent components by fitting second-moment assumptions.</span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    endog : array_like</span>
<span class="s2">        1d array of endogenous response variable. In case of multiple responses, the user must pass the responses on a list.  </span>
<span class="s2">    exog : array_like</span>
<span class="s2">        A dataset with the endogenous matrix in a Numpy fashion. Since the library doesn&#39;t set an intercept by default, the user must add it. In the case of multiple responses, the user must pass the design matrices as a python list. </span>
<span class="s2">    z : array_like</span>
<span class="s2">        List with matrices components of the linear covariance matrix.</span>
<span class="s2">    link : array_like, string or None</span>
<span class="s2">        Specification for the link function. The MCGLM library implements the following options: identity, logit, power, log, probit, cauchy, cloglog, loglog, negativebinomial. In the case of None, the library chooses the identity link. In multiple responses, user must pass values as list.  </span>
<span class="s2">    variance : array_like, string or None</span>
<span class="s2">        Specification for the variance function. The MCGLM library implements the following options: constant, tweedie, binomialP, binomialPQ, geom_tweedie, poisson_tweedie. In the case of None, the library chooses the constant link. In multiple responses, user must pass values as list.   </span>
<span class="s2">    offset : array_like or None</span>
<span class="s2">        Offset for continuous or count. In multiple responses, user must pass values as list.   </span>
<span class="s2">    ntrial : array_like or None</span>
<span class="s2">        The parameter ntrial is key for binomial responses. In multiple responses, the user must pass values as a list.</span>
<span class="s2">    power_fixed : array_like or None</span>
<span class="s2">        The parameter power is key for Tweedie-like distributions, as it defines the overall behavior of the model. The library mcglm can also estimate the power parameter if power_fixed equals True. Therefore, in the case of variance functions, either tweedie, geom_tweedie, or poisson_tweedie. In multiple responses, the user must pass values as a list.</span>
<span class="s2">    maxiter : float or None</span>
<span class="s2">        The parameter maxiter defines the total maximum possible cycles of iterations for the optimization process. Defaults to 200.</span>
<span class="s2">    tol : float or None</span>
<span class="s2">        The parameter tol defines the minimum absolute change on parameters to run another optimization cycle. If the absolute updating value is lower than tol, the optimization process stops. Defaults to 0.0001.</span>
<span class="s2">    tuning : float or None</span>
<span class="s2">        The optimization process leverages two second-order algorithms for the estimation process. The parameter tuning is an additional component guiding the step size of the process, acting closely to the second-order derivatives. Defaults to 0.5.</span>
<span class="s2">    weights : array_like or None</span>
<span class="s2">        The parameter weights allows one to specificy sample weights.</span>
<span class="s2">        </span>
<span class="s2">    Examples</span>
<span class="s2">    ----------</span>
<span class="s2">    &gt;&gt;&gt; import statsmodels.api as sm</span>
<span class="s2">    &gt;&gt;&gt; data = sm.datasets.scotland.load()</span>
<span class="s2">    &gt;&gt;&gt; data.exog = sm.add_constant(data.exog)</span>
<span class="s2">    </span>
<span class="s2">    &gt;&gt;&gt; model = sm.GLM(data.endog, data.exog, z=[mc_id(data.exog)],</span>
<span class="s2">    ...                      link=&quot;log&quot;, variance=&quot;tweedie&quot;,</span>
<span class="s2">    ...                      power=2, power_fixed=False)</span>
<span class="s2">    </span>
<span class="s2">    &gt;&gt;&gt; model_results = model.fit()</span>
<span class="s2">    &gt;&gt;&gt; model_results.mu</span>
<span class="s2">    &gt;&gt;&gt; model_results.pearson_residuals</span>
<span class="s2">    &gt;&gt;&gt; model_results.aic</span>
<span class="s2">    &gt;&gt;&gt; model_results.bic</span>
<span class="s2">    &gt;&gt;&gt; model_results.loglikelihood</span>
<span class="s2">    </span>
<span class="s2">    Notes</span>
<span class="s2">    -----</span>
<span class="s2">    MCGLM is a brand new model, which provides a solid statistical model for fitting multi-responses non-gaussian, dependent, or independent data based on second-moment assumptions. When a user instantiates an mcglm object, she must specify attributes such as link, variance, and z matrices; it will drive the overall behavior of the model.</span>
<span class="s2">    For more details, check articles and documentation provided.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endog</span><span class="p">,</span>
        <span class="n">exog</span><span class="p">,</span>
        <span class="n">z</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ntrial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">power_fixed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">maxiter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
        <span class="n">tuning</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MCGLM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="o">=</span> <span class="n">maxiter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tol</span> <span class="o">=</span> <span class="n">tol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tuning</span> <span class="o">=</span> <span class="n">tuning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="n">weights</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_X</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ntrial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau_initial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_beta_initial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rho_initial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_initial</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_X</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ntrial</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tau_initial</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_beta_initial</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rho_initial</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_link</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_variance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_power_initial</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_static_attributes</span><span class="p">(</span>
            <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">power_fixed</span><span class="p">,</span> <span class="n">ntrial</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">df_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the degree of freedom for the model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_initial</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tau_initial</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">df_resid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the degree of freedom for the model residuals.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span>

    <span class="k">def</span> <span class="nf">__calculate_static_attributes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">power_fixed</span><span class="p">,</span> <span class="n">ntrial</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Base method to warm up the pivotal artifacts for model training. It fulfills the None with default values, sets the power value, and creates the base vectors.</span>

<span class="sd">        Args:</span>
<span class="sd">            endog (list or np.array): _description_</span>
<span class="sd">            exog (list or np.array): _description_</span>
<span class="sd">            link (list): _description_</span>
<span class="sd">            variance (list): _description_</span>
<span class="sd">            z (list): _description_</span>
<span class="sd">            offset (list): _description_</span>
<span class="sd">            power (list): _description_</span>
<span class="sd">            power_fixed (list): _description_</span>
<span class="sd">            ntrial (list): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">initial_power</span><span class="p">(</span><span class="n">variance</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">variance</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;binomialP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tweedie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;geom_tweedie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;poisson_tweedie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">variance</span> <span class="o">==</span> <span class="s2">&quot;binomialPQ&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="n">n_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">n_obs</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">n_targets</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">set_offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">set_link</span> <span class="o">=</span> <span class="n">link</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">set_variance</span> <span class="o">=</span> <span class="n">variance</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">set_power_fixed</span> <span class="o">=</span> <span class="n">power_fixed</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">set_power</span> <span class="o">=</span> <span class="n">power</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="n">offset_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">link_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">variance_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">power_fixed_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">power_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">y_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">y_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">n_targets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reformat_dataset</span><span class="p">(</span><span class="n">exog</span><span class="p">)]</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reformat_dataset</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
            <span class="n">y_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_reformat_dataset</span><span class="p">(</span><span class="n">endog</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="p">]</span>
            <span class="n">ntrial</span> <span class="o">=</span> <span class="p">[</span><span class="n">ntrial</span><span class="p">]</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]]</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">offset_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">if</span> <span class="n">set_offset</span> <span class="k">else</span> <span class="p">[</span><span class="n">offset</span><span class="p">]</span>
            <span class="n">link_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;identity&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">set_link</span> <span class="k">else</span> <span class="p">[</span><span class="n">link</span><span class="p">]</span>
            <span class="n">variance_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">set_variance</span> <span class="k">else</span> <span class="p">[</span><span class="n">variance</span><span class="p">]</span>
            <span class="n">power_fixed_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="k">if</span> <span class="n">set_power_fixed</span> <span class="k">else</span> <span class="p">[</span><span class="n">power_fixed</span><span class="p">]</span>
            <span class="n">power_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_power</span><span class="p">(</span><span class="n">variance_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="k">if</span> <span class="n">set_power</span> <span class="k">else</span> <span class="p">[</span><span class="n">power</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">exog</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_offset</span><span class="p">:</span>
                <span class="n">offset_list</span> <span class="o">=</span> <span class="n">offset</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_link</span><span class="p">:</span>
                <span class="n">link_list</span> <span class="o">=</span> <span class="n">link</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_variance</span><span class="p">:</span>
                <span class="n">variance_list</span> <span class="o">=</span> <span class="n">variance</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_power_fixed</span><span class="p">:</span>
                <span class="n">power_fixed_list</span> <span class="o">=</span> <span class="n">power_fixed</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_power</span><span class="p">:</span>
                <span class="n">power_list</span> <span class="o">=</span> <span class="n">power</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_targets</span><span class="p">):</span>
                <span class="n">tau</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">index</span><span class="p">]))])</span>
                <span class="n">beta</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">exog</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
                <span class="n">y_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reformat_dataset</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">y_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reformat_dataset</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">set_offset</span><span class="p">:</span>
                    <span class="n">offset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">set_link</span><span class="p">:</span>
                    <span class="n">link_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;identity&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">set_variance</span><span class="p">:</span>
                    <span class="n">variance_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">set_power_fixed</span><span class="p">:</span>
                    <span class="n">power_fixed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">set_power</span><span class="p">:</span>
                    <span class="n">power_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial_power</span><span class="p">(</span><span class="n">variance</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>

            <span class="n">rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_targets</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_targets</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="n">rho</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">n_targets</span><span class="p">,</span>
            <span class="n">n_obs</span><span class="p">,</span>
            <span class="n">X</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">y_names</span><span class="p">,</span>
            <span class="n">z</span><span class="p">,</span>
            <span class="n">ntrial</span><span class="p">,</span>
            <span class="n">tau</span><span class="p">,</span>
            <span class="n">beta</span><span class="p">,</span>
            <span class="n">rho</span><span class="p">,</span>
            <span class="n">offset_list</span><span class="p">,</span>
            <span class="n">link_list</span><span class="p">,</span>
            <span class="n">variance_list</span><span class="p">,</span>
            <span class="n">power_fixed_list</span><span class="p">,</span>
            <span class="n">power_list</span><span class="p">,</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_reformat_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>    
        <span class="k">return</span> <span class="n">dataset</span>


<div class="viewcode-block" id="MCGLM.fit">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLM.fit">[docs]</a>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The interface to run the inference for MCGLM statistical model.&quot;&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">regression_historical</span><span class="p">,</span>
            <span class="n">dispersion_historical</span><span class="p">,</span>
            <span class="n">residue</span><span class="p">,</span>
            <span class="n">varcov</span><span class="p">,</span>
            <span class="n">joint_inv_sensitivity</span><span class="p">,</span>
            <span class="n">joint_variability</span><span class="p">,</span>
            <span class="n">n_iter</span><span class="p">,</span>
            <span class="n">mu</span><span class="p">,</span>
            <span class="n">rho</span><span class="p">,</span>
            <span class="n">tau</span><span class="p">,</span>
            <span class="n">power</span><span class="p">,</span>
            <span class="n">parameters_target</span><span class="p">,</span>
            <span class="n">c_inverse</span><span class="p">,</span>
            <span class="n">c_values</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">()</span>

        <span class="n">regression_parameters</span> <span class="o">=</span> <span class="n">regression_historical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dispersion_parameters</span> <span class="o">=</span> <span class="n">dispersion_historical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">p_log_likelihood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__p_log_likelihood</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">c_values</span><span class="p">,</span> <span class="n">c_inverse</span>
        <span class="p">)</span>
        <span class="n">aic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__p_aic</span><span class="p">(</span><span class="n">p_log_likelihood</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="p">)</span>
        <span class="n">bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__p_bic</span><span class="p">(</span><span class="n">p_log_likelihood</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">MCGLMResults</span><span class="p">(</span>
            <span class="n">normalized_var_cov</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">varcov</span><span class="p">),</span>
            <span class="n">nobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span><span class="p">,</span>
            <span class="n">n_targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">,</span>
            <span class="n">y_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_names</span><span class="p">,</span>
            <span class="n">regression</span><span class="o">=</span><span class="n">regression_parameters</span><span class="p">,</span>
            <span class="n">dispersion</span><span class="o">=</span><span class="n">parameters_target</span><span class="p">,</span>
            <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span>
            <span class="n">residue</span><span class="o">=</span><span class="n">residue</span><span class="p">,</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span>
            <span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
            <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span>
            <span class="n">link</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_link</span><span class="p">,</span>
            <span class="n">variance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_variance</span><span class="p">,</span>
            <span class="n">power_fixed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">,</span>
            <span class="n">p_log_likelihood</span><span class="o">=</span><span class="n">p_log_likelihood</span><span class="p">,</span>
            <span class="n">aic</span><span class="o">=</span><span class="n">aic</span><span class="p">,</span>
            <span class="n">bic</span><span class="o">=</span><span class="n">bic</span><span class="p">,</span>
            <span class="n">df_resid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_resid</span><span class="p">,</span>
            <span class="n">df_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_model</span><span class="p">,</span>
            <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">y_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">,</span>
            <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_X</span><span class="p">,</span>
            <span class="n">ntrial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ntrial</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__p_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">c_values</span><span class="p">,</span> <span class="n">c_inverse</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gaussian Pseudo-loglikelihood</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">det_sigma</span><span class="p">,</span> <span class="n">inv_sigma</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">math</span>

            <span class="n">size_residue</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residue</span><span class="p">)</span>
            <span class="n">dens</span> <span class="o">=</span> <span class="p">(</span>
                <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">size_residue</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">det_sigma</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">inv_sigma</span> <span class="o">*</span> <span class="n">residue</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">dens</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">residue</span> <span class="o">=</span> <span class="n">endog</span> <span class="o">-</span> <span class="n">mu</span>
        <span class="n">det_sigma</span> <span class="o">=</span> <span class="n">slogdet</span><span class="p">(</span><span class="n">block_diag</span><span class="p">(</span><span class="n">c_values</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log_likelihood</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span>
            <span class="n">residue</span><span class="o">=</span><span class="n">residue</span><span class="p">,</span> <span class="n">det_sigma</span><span class="o">=</span><span class="n">det_sigma</span><span class="p">,</span> <span class="n">inv_sigma</span><span class="o">=</span><span class="n">c_inverse</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">log_likelihood</span>

    <span class="k">def</span> <span class="nf">__p_aic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_loglike</span><span class="p">,</span> <span class="n">degrees_of_freedom</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pseudo Akaike Information criterion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">degrees_of_freedom</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pseudo_loglike</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__p_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_loglike</span><span class="p">,</span> <span class="n">degrees_of_freedom</span><span class="p">,</span> <span class="n">length_endogenous</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pseudo Bayesian Information criterion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span>
            <span class="n">degrees_of_freedom</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">length_endogenous</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pseudo_loglike</span><span class="p">,</span> <span class="mi">2</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method implements the core inference for MCGLM, by all the means of the two-moment assumptions.&quot;&quot;&quot;</span>
        <span class="n">W</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">)))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span>
        <span class="p">)</span>

        <span class="n">regression_historical</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dispersion_historical</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># To a warm up the start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_optimal_dispersion</span><span class="p">()</span>

        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho_initial</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau_initial</span>
        <span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_initial</span>

        <span class="c1"># Setting up</span>
        <span class="n">regression</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_beta_initial</span><span class="p">)</span>
        <span class="n">dispersion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__create_dispersion_vector</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">tau</span><span class="p">))</span>

        <span class="n">regression_historical</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regression</span><span class="p">)</span>
        <span class="n">dispersion_historical</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dispersion</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span><span class="p">):</span>
            <span class="c1"># First moment</span>

            <span class="p">(</span>
                <span class="n">new_regression</span><span class="p">,</span>
                <span class="n">quasi_score</span><span class="p">,</span>
                <span class="n">mean_sensitivity</span><span class="p">,</span>
                <span class="n">mean_variability</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_beta</span><span class="p">(</span><span class="n">regression</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
            <span class="n">regression_historical</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_regression</span><span class="p">)</span>

            <span class="c1"># Second moment</span>
            <span class="n">mu_attributes</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu_derivatives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_mean_features</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_link</span><span class="p">,</span> <span class="n">new_regression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span>
            <span class="p">)</span>

            <span class="p">(</span>
                <span class="n">new_dispersion</span><span class="p">,</span>
                <span class="n">c_inverse</span><span class="p">,</span>
                <span class="n">c_values</span><span class="p">,</span>
                <span class="n">c_derivatives_componentes</span><span class="p">,</span>
                <span class="n">var_sensitivity</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_covariates</span><span class="p">(</span>
                <span class="n">mu_attributes</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">,</span> <span class="n">mu</span>
            <span class="p">)</span>

            <span class="n">dispersion_historical</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dispersion</span><span class="p">)</span>

            <span class="n">regression</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__iteration_update</span><span class="p">(</span>
                <span class="n">new_regression</span><span class="p">,</span> <span class="n">new_dispersion</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">tau</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__check_stop_criterion</span><span class="p">(</span>
                <span class="n">regression_historical</span><span class="p">,</span> <span class="n">dispersion_historical</span>
            <span class="p">):</span>
                <span class="k">break</span>

        <span class="n">residue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span> <span class="o">-</span> <span class="n">mu</span>

        <span class="p">(</span>
            <span class="n">varcov</span><span class="p">,</span>
            <span class="n">joint_inv_sensitivity</span><span class="p">,</span>
            <span class="n">joint_variability</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">_parameters_attributes</span><span class="p">(</span>
            <span class="n">residue</span><span class="p">,</span>
            <span class="n">mu_derivatives</span><span class="p">,</span>
            <span class="n">W</span><span class="p">,</span>
            <span class="n">quasi_score</span><span class="p">,</span>
            <span class="n">mean_sensitivity</span><span class="p">,</span>
            <span class="n">mean_variability</span><span class="p">,</span>
            <span class="n">c_inverse</span><span class="p">,</span>
            <span class="n">c_values</span><span class="p">,</span>
            <span class="n">c_derivatives_componentes</span><span class="p">,</span>
            <span class="n">var_sensitivity</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">parameters_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dispersion_parameters</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">regression_historical</span><span class="p">,</span>
            <span class="n">dispersion_historical</span><span class="p">,</span>
            <span class="n">residue</span><span class="p">,</span>
            <span class="n">varcov</span><span class="p">,</span>
            <span class="n">joint_inv_sensitivity</span><span class="p">,</span>
            <span class="n">joint_variability</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">iter</span><span class="p">),</span>
            <span class="n">mu</span><span class="p">,</span>
            <span class="n">rho</span><span class="p">,</span>
            <span class="n">tau</span><span class="p">,</span>
            <span class="n">power</span><span class="p">,</span>
            <span class="n">parameters_target</span><span class="p">,</span>
            <span class="n">c_inverse</span><span class="p">,</span>
            <span class="n">c_values</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_dispersion_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">):</span>

        <span class="n">covariances</span> <span class="o">=</span> <span class="n">dispersion</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">covariances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">))])</span>

        <span class="n">parameters_target</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">):</span>
            <span class="n">power_mu</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_initial</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">else</span> <span class="n">covariances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mu</span><span class="p">[</span><span class="n">index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span> <span class="p">:</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="n">size_parameters</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="n">scale_output</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;scalelist&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="nb">round</span><span class="p">(</span><span class="n">covariances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size_parameters</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">}</span>

            <span class="n">parameters_target</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="o">**</span><span class="n">scale_output</span><span class="p">,</span> <span class="o">**</span><span class="n">power_mu</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">parameters_target</span>

    <span class="k">def</span> <span class="nf">__check_stop_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regression_historical</span><span class="p">,</span> <span class="n">dispersion_historical</span><span class="p">):</span>
        <span class="n">regression_lift</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">regression_historical</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regression_historical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dispersion_lift</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dispersion_historical</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dispersion_historical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regression_lift</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">regression_lift</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tol</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                <span class="n">dispersion_lift</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tol</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__iteration_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_regression</span><span class="p">,</span> <span class="n">new_dispersion</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">new_regression</span><span class="p">,</span> <span class="n">new_dispersion</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="p">[</span><span class="n">new_dispersion</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">new_regression</span><span class="p">,</span>
                    <span class="n">new_dispersion</span><span class="p">,</span>
                    <span class="n">rho</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">new_dispersion</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="p">[</span><span class="n">new_dispersion</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">new_rho</span> <span class="o">=</span> <span class="n">new_dispersion</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">)]</span>
            <span class="n">stack_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_rho</span> <span class="o">=</span> <span class="n">new_dispersion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stack_index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">new_power</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">new_tau</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)):</span>
            <span class="c1"># power section</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">[</span><span class="n">position</span><span class="p">]:</span>
                <span class="n">new_power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">position</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dispersion</span><span class="p">[</span><span class="n">stack_index</span><span class="p">])</span>
                <span class="n">stack_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># tau section.</span>
            <span class="n">additions</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_tau</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">position</span><span class="p">])):</span>
                <span class="n">temp_tau</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dispersion</span><span class="p">[</span><span class="n">stack_index</span> <span class="o">+</span> <span class="n">index</span><span class="p">])</span>
                <span class="n">additions</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stack_index</span> <span class="o">+=</span> <span class="n">additions</span>
            <span class="n">new_tau</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_tau</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_regression</span><span class="p">,</span> <span class="n">new_dispersion</span><span class="p">,</span> <span class="n">new_rho</span><span class="p">,</span> <span class="n">new_power</span><span class="p">,</span> <span class="n">new_tau</span>

    <span class="k">def</span> <span class="nf">__create_dispersion_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">covariance</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">covariance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n_outputs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed</span><span class="p">[</span><span class="n">n_outputs</span><span class="p">]:</span>
                <span class="n">covariance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">[</span><span class="n">n_outputs</span><span class="p">])</span>
            <span class="n">covariance</span> <span class="o">=</span> <span class="n">covariance</span> <span class="o">+</span> <span class="n">tau</span><span class="p">[</span><span class="n">n_outputs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">covariance</span>

    <span class="k">def</span> <span class="nf">__update_optimal_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update optimal dispersion method calculates optimal values for regression parameters and the dispersion. It harnesses the GLM API of statsmodels for calculating those values.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">logit_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the Logit link function, the method adjusts a GLM with Binomial family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">loglog_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the LogLog link function, the method adjusts a GLM with Binomial family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">LogLog</span><span class="p">()),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">cloglog_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the CLogLog link function, the method adjusts a GLM with Binomial family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span>
                <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">CLogLog</span><span class="p">()),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
            <span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">cauchy_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the Cauchy link function, the method adjusts a GLM with Binomial family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">cauchy</span><span class="p">()),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">probit_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the Cauchy link function, the method adjusts a GLM with Binomial family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="n">probit</span><span class="p">()),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">identity_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the Identity link function, the method adjusts a OLS. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">log_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the Log link function, the method adjusts a GLM with Tweedie(power=1) family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span>
                <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Tweedie</span><span class="p">(</span><span class="n">var_power</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
            <span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">power_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For either the Power or Reciprocal link function, the method adjusts a GLM with Tweedie(power=2) family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span>
                <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Tweedie</span><span class="p">(</span><span class="n">var_power</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
            <span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">negative_binomial_est</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the Negative Binomial link function, the method adjusts a GLM with Tweedie(power=2) family. It retrieves the parameters specified.</span>

<span class="sd">            Args:</span>
<span class="sd">                endog (array-like): outcome variable.</span>
<span class="sd">                exog (array-like): independent variables.</span>
<span class="sd">                offset (int): shift on response variable.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tuple: regression parameters, dispersion parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">mdl</span> <span class="o">=</span> <span class="n">GLM</span><span class="p">(</span>
                <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Tweedie</span><span class="p">(</span><span class="n">var_power</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span>
            <span class="p">)</span>
            <span class="n">mdl_results</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">mdl_results</span><span class="o">.</span><span class="n">scale</span>

        <span class="n">first_estimation</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;logit&quot;</span><span class="p">:</span> <span class="n">logit_est</span><span class="p">,</span>
            <span class="s2">&quot;identity&quot;</span><span class="p">:</span> <span class="n">identity_est</span><span class="p">,</span>
            <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="n">power_est</span><span class="p">,</span>
            <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">log_est</span><span class="p">,</span>
            <span class="s2">&quot;probit&quot;</span><span class="p">:</span> <span class="n">probit_est</span><span class="p">,</span>
            <span class="s2">&quot;cauchy&quot;</span><span class="p">:</span> <span class="n">cauchy_est</span><span class="p">,</span>
            <span class="s2">&quot;cloglog&quot;</span><span class="p">:</span> <span class="n">cloglog_est</span><span class="p">,</span>
            <span class="s2">&quot;loglog&quot;</span><span class="p">:</span> <span class="n">loglog_est</span><span class="p">,</span>
            <span class="s2">&quot;negativebinomial&quot;</span><span class="p">:</span> <span class="n">negative_binomial_est</span><span class="p">,</span>
            <span class="s2">&quot;inverse_power&quot;</span><span class="p">:</span> <span class="n">log_est</span><span class="p">,</span>
            <span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span> <span class="n">power_est</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_beta_initial</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">dispersion</span> <span class="o">=</span> <span class="n">first_estimation</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_link</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
            <span class="p">](</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">[</span>
                    <span class="n">target</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span> <span class="p">:</span> <span class="n">target</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_obs</span>
                <span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_X</span><span class="p">[</span><span class="n">target</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span><span class="p">[</span><span class="n">target</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tau_initial</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dispersion</span></div>



<div class="viewcode-block" id="MCGLMParameters">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLMParameters">[docs]</a>
<span class="k">class</span> <span class="nc">MCGLMParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;According to MCGLM specification, grounded for frequentist inference traits, the estimation of resulting parameters converge asymptotically to a gaussian distribution with tuple mean-variance = (actual parameters, inverse of matrix Godambe). This property allows the calculation of pivotal traits regarding the parameters, such as: hypothesis testing and confidence interval.</span>

<span class="sd">    This class implements every method related to this trait.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parameters_attributes</span><span class="p">(</span>
        <span class="n">resid</span><span class="p">,</span>
        <span class="n">mu_deriv</span><span class="p">,</span>
        <span class="n">W</span><span class="p">,</span>
        <span class="n">quasi_score</span><span class="p">,</span>
        <span class="n">mean_sens</span><span class="p">,</span>
        <span class="n">mean_varia</span><span class="p">,</span>
        <span class="n">c_inv</span><span class="p">,</span>
        <span class="n">c</span><span class="p">,</span>
        <span class="n">c_deriv</span><span class="p">,</span>
        <span class="n">var_sensi</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The parameters of MCGLM converge assymtoptically to a Normal Distribution. This trait allows some statistical inferences as hypothesis testing, confidence interval and so on. This method crafts three important matrices: Varcov: variance covariance matrix, joint_inv_sensitivity: inverse sensitivity, and joint_variability: the joint variability distribution.&quot;&quot;&quot;</span>

        <span class="n">variance_variability</span> <span class="o">=</span> <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">generate_var_variability</span><span class="p">(</span>
            <span class="n">resid</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">c_inv</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c_deriv</span>
        <span class="p">)</span>

        <span class="n">inv_cw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c_inv</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

        <span class="n">s_cov_beta</span> <span class="o">=</span> <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">_mc_cross_sensitivity</span><span class="p">(</span>
            <span class="n">cov_product</span><span class="o">=</span><span class="n">c_deriv</span><span class="p">,</span>
            <span class="n">columns_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">quasi_score</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">v_cov_beta</span> <span class="o">=</span> <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">_mc_cross_variability</span><span class="p">(</span>
            <span class="n">cov_product</span><span class="o">=</span><span class="n">c_deriv</span><span class="p">,</span>
            <span class="n">inv_cw</span><span class="o">=</span><span class="n">inv_cw</span><span class="p">,</span>
            <span class="n">res</span><span class="o">=</span><span class="n">resid</span><span class="p">,</span>
            <span class="n">d</span><span class="o">=</span><span class="n">mu_deriv</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_varia</span><span class="p">,</span> <span class="n">v_cov_beta</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_cov_beta</span><span class="p">,</span> <span class="n">variance_variability</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">joint_variability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">inv_J_beta</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">mean_sens</span><span class="p">)</span>
        <span class="n">inv_S_beta</span> <span class="o">=</span> <span class="n">inv_J_beta</span>
        <span class="n">inv_S_cov</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">var_sensi</span><span class="p">)</span>
        <span class="n">mat0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">s_cov_beta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s_cov_beta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">cross_term</span> <span class="o">=</span> <span class="n">mc_sandwich</span><span class="p">(</span><span class="n">s_cov_beta</span><span class="p">,</span> <span class="o">-</span><span class="n">inv_S_cov</span><span class="p">,</span> <span class="n">inv_S_beta</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inv_S_beta</span><span class="p">,</span> <span class="n">cross_term</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat0</span><span class="p">,</span> <span class="n">inv_S_cov</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">joint_inv_sensitivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">varcov</span> <span class="o">=</span> <span class="n">mc_sandwich</span><span class="p">(</span>
            <span class="n">joint_variability</span><span class="p">,</span> <span class="n">joint_inv_sensitivity</span><span class="p">,</span> <span class="n">joint_inv_sensitivity</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">varcov</span><span class="p">,</span>
            <span class="n">joint_inv_sensitivity</span><span class="p">,</span>
            <span class="n">joint_variability</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mc_cross_sensitivity</span><span class="p">(</span><span class="n">cov_product</span><span class="p">,</span> <span class="n">columns_size</span><span class="p">):</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov_product</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span> <span class="n">columns_size</span><span class="p">))</span>

<div class="viewcode-block" id="MCGLMParameters.generate_var_variability">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLMParameters.generate_var_variability">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_var_variability</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c_inv</span><span class="p">,</span> <span class="n">c_val</span><span class="p">,</span> <span class="n">c_comp</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">_calculate_variability</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="n">c_comp</span><span class="p">,</span>
            <span class="n">inv_C</span><span class="o">=</span><span class="n">c_inv</span><span class="p">,</span>
            <span class="n">C</span><span class="o">=</span><span class="n">c_val</span><span class="p">,</span>
            <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span>
            <span class="n">W</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_calculate_variability</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">inv_C</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="n">n_par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="n">we</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">product</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">inv_C</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_par</span><span class="p">)]</span>

        <span class="n">k4</span> <span class="o">=</span> <span class="n">res</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">MCGLMVariance</span><span class="o">.</span><span class="n">generate_sensitivity</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">variability</span> <span class="o">=</span> <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">_mc_variability</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">k4</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">variability</span>

    <span class="k">def</span> <span class="nf">_mc_variability</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">,</span> <span class="n">we</span><span class="p">,</span> <span class="n">k4</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="n">variability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">position_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">we</span><span class="p">)):</span>
            <span class="n">wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">we</span><span class="p">[</span><span class="n">position_row</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">position_col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">we</span><span class="p">)):</span>
                <span class="n">wj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">we</span><span class="p">[</span><span class="n">position_col</span><span class="p">])</span>

                <span class="n">k4_operation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k4</span> <span class="o">*</span> <span class="n">wi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">wj</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>

                <span class="n">variability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">variability</span><span class="p">,</span>
                    <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sensitivity</span><span class="o">.</span><span class="n">item</span><span class="p">((</span><span class="n">position_row</span><span class="p">,</span> <span class="n">position_col</span><span class="p">))</span> <span class="o">+</span> <span class="n">k4_operation</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">variability</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">we</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">we</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_covprod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="n">calculation_sandwich</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">calculation_residue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">calculation_sandwich</span><span class="p">,</span> <span class="n">calculation_residue</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">product</span>

    <span class="k">def</span> <span class="nf">_mc_cross_variability</span><span class="p">(</span><span class="n">cov_product</span><span class="p">,</span> <span class="n">inv_cw</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>

        <span class="n">wlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">inv_cw</span><span class="p">)</span> <span class="k">for</span> <span class="n">cov</span> <span class="ow">in</span> <span class="n">cov_product</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">inv_cw</span><span class="p">)</span>

        <span class="n">n_beta</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_cov</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov_product</span><span class="p">)</span>
        <span class="n">cross_variability</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cov</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cov</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_beta</span><span class="p">):</span>
                <span class="n">cross_variability</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">MCGLMParameters</span><span class="o">.</span><span class="n">_covprod</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">beta</span><span class="p">,</span> <span class="p">:],</span> <span class="n">wlist</span><span class="p">[</span><span class="n">cov</span><span class="p">],</span> <span class="n">res</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">cross_variability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cross_variability</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_cov</span><span class="p">,</span> <span class="n">n_beta</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">cross_variability</span></div>



<div class="viewcode-block" id="MCGLMResults">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLMResults">[docs]</a>
<span class="k">class</span> <span class="nc">MCGLMResults</span><span class="p">(</span><span class="n">GLMResults</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MCGLM Class for generating and manipulating results of mcglm training. The main output goes by the method summary(), the classical statsmodels output. Therefore, the user can access the attributes &quot;aic&quot;, &quot;bic&quot; e loglikelihood.</span>

<span class="sd">    Args:</span>
<span class="sd">        GLMResults: Class of statsmodels library for presenting results of GLM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">normalized_var_cov</span><span class="p">,</span>
        <span class="n">nobs</span><span class="p">,</span>
        <span class="n">n_targets</span><span class="p">,</span>
        <span class="n">y_names</span><span class="p">,</span>
        <span class="n">regression</span><span class="p">,</span>
        <span class="n">dispersion</span><span class="p">,</span>
        <span class="n">n_iter</span><span class="p">,</span>
        <span class="n">residue</span><span class="p">,</span>
        <span class="n">rho</span><span class="p">,</span>
        <span class="n">tau</span><span class="p">,</span>
        <span class="n">power</span><span class="p">,</span>
        <span class="n">link</span><span class="p">,</span>
        <span class="n">variance</span><span class="p">,</span>
        <span class="n">power_fixed</span><span class="p">,</span>
        <span class="n">p_log_likelihood</span><span class="p">,</span>
        <span class="n">aic</span><span class="p">,</span>
        <span class="n">bic</span><span class="p">,</span>
        <span class="n">df_resid</span><span class="p">,</span>
        <span class="n">df_model</span><span class="p">,</span>
        <span class="n">mu</span><span class="p">,</span>
        <span class="n">y_values</span><span class="p">,</span>
        <span class="n">X</span><span class="p">,</span>
        <span class="n">ntrial</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_var_cov</span> <span class="o">=</span> <span class="n">normalized_var_cov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span> <span class="o">=</span> <span class="n">nobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">=</span> <span class="n">n_targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_names</span> <span class="o">=</span> <span class="n">y_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_regression</span> <span class="o">=</span> <span class="n">regression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispersion</span> <span class="o">=</span> <span class="n">dispersion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_residue</span> <span class="o">=</span> <span class="n">residue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span> <span class="o">=</span> <span class="n">rho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau</span> <span class="o">=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_list</span> <span class="o">=</span> <span class="n">power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_list</span> <span class="o">=</span> <span class="n">link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variance_list</span> <span class="o">=</span> <span class="n">variance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed_list</span> <span class="o">=</span> <span class="n">power_fixed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p_log_likelihood</span> <span class="o">=</span> <span class="n">p_log_likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p_aic</span> <span class="o">=</span> <span class="n">aic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p_bic</span> <span class="o">=</span> <span class="n">bic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_resid</span> <span class="o">=</span> <span class="n">df_resid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df_model</span> <span class="o">=</span> <span class="n">df_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mu_value</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span> <span class="o">=</span> <span class="n">y_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ntrial</span> <span class="o">=</span> <span class="n">ntrial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.bse = None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_use_t</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_aic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_bic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loglikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_log_likelihood</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The standard errors of the parameter estimates.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cov_params_default&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">bse_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
            <span class="n">bse_</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bse_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bse_</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the t-statistic for a given parameter estimate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bse</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mu_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The two-tailed p values for the t-stats of the params.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_t</span><span class="p">:</span>
            <span class="n">df_resid</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;df_resid_inference&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_resid</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tvalues</span><span class="p">),</span> <span class="n">df_resid</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tvalues</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pearson_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pearson residuals.  The Pearson residuals are defined as</span>
<span class="sd">        (`endog` - `mu`)/sqrt(VAR(`mu`)) where VAR is the distribution</span>
<span class="sd">        specific variance function.  See statsmodels.families.family and</span>
<span class="sd">        statsmodels.families.varfuncs for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">):</span>
            <span class="n">residue</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_y_values</span><span class="p">[</span><span class="n">index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span> <span class="p">:</span> <span class="n">index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">mu</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">variance</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;binomialP&quot;</span><span class="p">,</span> <span class="s2">&quot;binomialPQ&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">):</span>
                <span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">variance</span> <span class="o">=</span> <span class="s2">&quot;power&quot;</span>

            <span class="n">variance_sqrt_output</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">MCGLMCAttributes</span><span class="p">()</span>
                <span class="o">.</span><span class="n">_generate_variance</span><span class="p">(</span>
                    <span class="n">variance</span><span class="p">,</span>
                    <span class="n">mu</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_power_list</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ntrial</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variance_sqrt_output&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residue</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">variance_sqrt_output</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">residuals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vcov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span>

<div class="viewcode-block" id="MCGLMResults.anova">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLMResults.anova">[docs]</a>
    <span class="k">def</span> <span class="nf">anova</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">indexes_covariates</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">covariate_name</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">]]</span>
    <span class="p">):</span>

        <span class="n">total_anovas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">position_target</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">n_targets</span><span class="p">):</span>
            <span class="n">dispersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dispersion</span><span class="p">[</span><span class="n">position_target</span><span class="p">][</span><span class="s2">&quot;scalelist&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">dispersion_vcov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispersion_vcov</span><span class="p">[</span><span class="n">position_target</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">covariates_positions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">indexes_covariates</span><span class="p">[</span><span class="n">position_target</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="n">covariates_names</span> <span class="o">=</span> <span class="n">covariate_name</span><span class="p">[</span><span class="n">position_target</span><span class="p">]</span>

            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">index_name</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">anovas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">covs</span> <span class="ow">in</span> <span class="n">covariates_positions</span><span class="p">:</span>

                <span class="n">current_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dispersion</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">covs</span><span class="p">)])</span>
                <span class="n">current_vcov</span> <span class="o">=</span> <span class="n">dispersion_vcov</span><span class="p">[</span>
                    <span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">covs</span><span class="p">),</span> <span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">covs</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">solve_vcoc</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">current_vcov</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">solve_vcoc</span> <span class="o">=</span> <span class="n">current_vcov</span>

                <span class="n">chi_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                    <span class="n">current_cov</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">solve_vcoc</span><span class="p">,</span> <span class="n">current_cov</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covs</span><span class="p">)</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">ncx2</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">chi_square</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covs</span><span class="p">)</span>
                <span class="n">anovas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;covariate_name&quot;</span><span class="p">:</span> <span class="n">covariates_names</span><span class="p">[</span><span class="n">index_name</span><span class="p">],</span>
                        <span class="s2">&quot;chi_square&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">chi_square</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                        <span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span>
                        <span class="s2">&quot;pvalue&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">pvalue</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="n">index_name</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_anovas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">anovas</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">total_anovas</span></div>


    <span class="k">def</span> <span class="nf">__add_table_two_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">summ</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
    <span class="p">):</span>
        <span class="n">top_left</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Dep. Variable:&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Model:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;MCGLM&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;link:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;variance:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;Method:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Quasi-Likelihood&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;Date:&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Time:&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;No. Iterations:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_iter</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;No. Observations:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;Df Residuals:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_resid</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;Df Model:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_model</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;Power-fixed:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">power_fixed</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;pAIC&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">paic</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;pBIC&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pbic</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;pLogLik&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_log_likelihood</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]),</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cov_type&quot;</span><span class="p">):</span>
            <span class="n">top_left</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Covariance Type:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Multivariate Covariance Generalized Linear Model&quot;</span>

        <span class="n">summ</span><span class="o">.</span><span class="n">add_table_2cols</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">gleft</span><span class="o">=</span><span class="n">top_left</span><span class="p">,</span>
            <span class="n">gright</span><span class="o">=</span><span class="n">top_right</span><span class="p">,</span>
            <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span>
            <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">summ</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">yname</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">xname</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">use_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_t</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">summ</span>

    <span class="k">def</span> <span class="nf">__add_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summ</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="n">summ</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">xname</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dispersion_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">))],</span>
            <span class="n">use_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_t</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">summ</span>

    <span class="k">def</span> <span class="nf">__add_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summ</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="n">summ</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">xname</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;power_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
            <span class="p">],</span>
            <span class="n">use_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_t</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">summ</span>

    <span class="k">def</span> <span class="nf">__add_rho_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summ</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho_vcov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">)):</span>
            <span class="n">summ</span><span class="o">.</span><span class="n">add_table_params</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">xname</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;rho_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
                <span class="p">],</span>
                <span class="n">use_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_t</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;constraints&quot;</span><span class="p">):</span>
                <span class="n">summ</span><span class="o">.</span><span class="n">add_extra_txt</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;Model has been estimated subject to linear &quot;</span>
                        <span class="s2">&quot;equality constraints.&quot;</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">summ</span>

<div class="viewcode-block" id="MCGLMResults.summary">
<a class="viewcode-back" href="../../mcglm.html#mcglm.mcglm.MCGLMResults.summary">[docs]</a>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It generates the summary report as the sketch of classical &quot;statsmodels&quot; library. The summary shows all parameters found thoroughly, for each response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispersion_vcov</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">betas_vcov</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rho_vcov</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power_vcov</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">index_position</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cov_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_var_cov</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rho_vcov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">):</span>

            <span class="n">n_betas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_regression</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">betas_vcov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">cov_params</span><span class="p">[</span>
                    <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="n">n_betas</span><span class="p">,</span>
                    <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="n">n_betas</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">index_position</span> <span class="o">+=</span> <span class="n">n_betas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rho_vcov</span> <span class="o">=</span> <span class="n">cov_params</span><span class="p">[</span>
                <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">),</span>
                <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">),</span>
            <span class="p">]</span>

            <span class="n">index_position</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed_list</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_vcov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_vcov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="n">cov_params</span><span class="p">[</span>
                            <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">index_position</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">n_dispersion</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dispersion</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;scalelist&quot;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dispersion_vcov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">cov_params</span><span class="p">[</span>
                    <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="n">n_dispersion</span><span class="p">,</span>
                    <span class="n">index_position</span> <span class="p">:</span> <span class="n">index_position</span> <span class="o">+</span> <span class="n">n_dispersion</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">index_position</span> <span class="o">+=</span> <span class="n">n_dispersion</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">smry</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">target_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_targets</span><span class="p">):</span>
            <span class="n">exog_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_X</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">y_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_names</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_list</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance_list</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_fixed_list</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regression</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">betas_vcov</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">loglikehood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_log_likelihood</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_aic</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_bic</span>

            <span class="n">smry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_table_two_columns</span><span class="p">(</span><span class="n">smry</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">y_name</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">exog_names</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dispersion</span><span class="p">[</span><span class="n">target_index</span><span class="p">][</span><span class="s2">&quot;scalelist&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispersion_vcov</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>

            <span class="c1"># self.bse = np.sqrt(np.diag(self.normalized_cov_params))</span>
            <span class="n">smry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_dispersion</span><span class="p">(</span><span class="n">smry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_dispersion</span><span class="p">[</span><span class="n">target_index</span><span class="p">][</span><span class="s2">&quot;power&quot;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalized_cov_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_vcov</span><span class="p">[</span><span class="n">target_index</span><span class="p">]</span>

            <span class="n">smry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_power</span><span class="p">(</span><span class="n">smry</span><span class="p">)</span>

        <span class="n">smry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_rho_section</span><span class="p">(</span><span class="n">smry</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">smry</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jean Carlos Faoot Maia.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
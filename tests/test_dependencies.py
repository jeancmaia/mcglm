import pytest
import pandas as pd
import numpy as np

from mcglm import mc_id, mc_ma, mc_mixed


def test_mc_ma():
    id = [1, 1, 1, 1, 2, 2, 2, 2]
    time = [1, 2, 3, 4, 1, 2, 3, 4]

    df = pd.DataFrame([])

    df["id"] = id
    df["time"] = time

    z = mc_ma(id="id", time="time", data=df, order=2)

    np.testing.assert_equal(
        z,
        np.array(
            [
                [0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0],
                [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0],
                [0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0],
            ]
        ),
    )

    z = mc_ma(id="id", time="time", data=df, order=3)

    np.testing.assert_equal(
        z,
        np.array(
            [
                [0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0],
            ]
        ),
    )


def test_mc_mixed():
    id = [1, 1, 1, 1, 2, 2, 2, 2]
    time = [1, 2, 3, 4, 1, 2, 3, 4]

    df = pd.DataFrame([])

    df["id"] = id
    df["time"] = time

    z = mc_mixed(df, "~ time")

    np.testing.assert_equal(
        z[0],
        np.array(
            [
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
                [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
            ]
        ),
    )

    np.testing.assert_equal(
        z[1],
        np.array(
            [
                [1.0, 2.0, 3.0, 4.0, 1.0, 2.0, 3.0, 4.0],
                [2.0, 4.0, 6.0, 8.0, 2.0, 4.0, 6.0, 8.0],
                [3.0, 6.0, 9.0, 12.0, 3.0, 6.0, 9.0, 12.0],
                [4.0, 8.0, 12.0, 16.0, 4.0, 8.0, 12.0, 16.0],
                [1.0, 2.0, 3.0, 4.0, 1.0, 2.0, 3.0, 4.0],
                [2.0, 4.0, 6.0, 8.0, 2.0, 4.0, 6.0, 8.0],
                [3.0, 6.0, 9.0, 12.0, 3.0, 6.0, 9.0, 12.0],
                [4.0, 8.0, 12.0, 16.0, 4.0, 8.0, 12.0, 16.0],
            ]
        ),
    )

    np.testing.assert_equal(
        z[2],
        np.array(
            [
                [2.0, 3.0, 4.0, 5.0, 2.0, 3.0, 4.0, 5.0],
                [3.0, 4.0, 5.0, 6.0, 3.0, 4.0, 5.0, 6.0],
                [4.0, 5.0, 6.0, 7.0, 4.0, 5.0, 6.0, 7.0],
                [5.0, 6.0, 7.0, 8.0, 5.0, 6.0, 7.0, 8.0],
                [2.0, 3.0, 4.0, 5.0, 2.0, 3.0, 4.0, 5.0],
                [3.0, 4.0, 5.0, 6.0, 3.0, 4.0, 5.0, 6.0],
                [4.0, 5.0, 6.0, 7.0, 4.0, 5.0, 6.0, 7.0],
                [5.0, 6.0, 7.0, 8.0, 5.0, 6.0, 7.0, 8.0],
            ]
        ),
    )


def test_mc_id():
    id = [1, 1, 1]
    time = [1, 2, 3]

    df = pd.DataFrame([])

    df["id"] = id
    df["time"] = time

    z = mc_id(df)

    np.testing.assert_equal(z, np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]))
